<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="code android web">
<meta name="keywords" content="Andriod Web">
<meta property="og:type" content="website">
<meta property="og:title" content="CodingForEverything">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="CodingForEverything">
<meta property="og:description" content="code android web">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CodingForEverything">
<meta name="twitter:description" content="code android web">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>CodingForEverything</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">CodingForEverything</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">code everything from here</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/29/Gradle下载公司内部依赖失败问题排查/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhang Liang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://www.xda-developers.com/files/2013/12/android-code.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CodingForEverything">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/29/Gradle下载公司内部依赖失败问题排查/" itemprop="url">Gradle下载公司内部依赖失败问题排查</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-29T09:26:42+08:00">
                2018-09-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android开发笔记/" itemprop="url" rel="index">
                    <span itemprop="name">Android开发笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><p>最近的一个项目使用了公司自己的Maven库中的依赖，这个Maven库只能用公司内网访问。开始我设置了代理，<code>sync</code>后，有部分依赖不能下载，有时候<code>sync</code>依然会成功，但<code>build</code>一定会失败，执行<code>./gradlew build --stacktrack</code>,获得错误信息如下： </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Could not resolve xxxxx.xxx.xxx.xxx.</span><br></pre></td></tr></table></figure>
<p>只是公司自己的Maven库依赖不能解析，其他三方库依赖没有报错。 </p>
<h1 id="问题排查"><a href="#问题排查" class="headerlink" title="问题排查"></a>问题排查</h1><p>排查思路如下： </p>
<p><strong>一，确定公司内部Maven库能够从自己的电脑上访问</strong> </p>
<ol>
<li><p>是否能够<code>ping</code>通？ </p>
<p><code>$ ping xxx.xxx.xxx(公司内部Maven库服务地址)</code>。 </p>
</li>
<li><p>能够<code>ping</code>通后，再用浏览器尝试访问公司内部Maven库，看能够找到需要的依赖。 </p>
</li>
</ol>
<p>确定公司内部Maven库能够被访问后，再看下一步 </p>
<p><strong>二，确定自己的Gradle没有设置外部代理</strong> </p>
<p>如果设置了外部代理，则是从外部网络访问公司内部Maven，肯定是访问不了的。依次检查如下： </p>
<ol>
<li><p>项目根目录下的<code>gradle.properties</code>是否设置了代理。 </p>
</li>
<li><p>Android Studio是否设置了代理。”Preference -&gt; Appearence&amp;Behavior -&gt; System Settings -&gt; HTTP Proxy” </p>
</li>
<li><p>用户主目录<code>~/.gradle/gradle.properties</code>中是否设置了全局代理。 </p>
</li>
</ol>
<p>如果设置了代理，则关闭所有的代理或者设置内部Maven库地址不走代理，而其他的走代理。 </p>
<p><strong>内部Maven库地址不走代理设置</strong> </p>
<p><code>gradle.properties</code>设置如下： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemProp.http.nonProxyHosts=xxxx.xxxx.xxxx</span><br></pre></td></tr></table></figure>
<p>Android Studio设置如下： </p>
<p>在”Preference -&gt; Appearence&amp;Behavior -&gt; System Settings -&gt; HTTP Proxy”中的”No proxy for”中填入公司内部Host主机地址。 </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/10/开发笔记-Complie关键字过时WARNING解决/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhang Liang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://www.xda-developers.com/files/2013/12/android-code.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CodingForEverything">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/10/开发笔记-Complie关键字过时WARNING解决/" itemprop="url">开发笔记-Complie关键字过时警告问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-10T16:29:15+08:00">
                2018-09-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android开发笔记/" itemprop="url" rel="index">
                    <span itemprop="name">Android开发笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><p>之前构建Android项目时，经常出现以下WARNING：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WARNING: Configuration <span class="string">'compile'</span> is obsolete and has been replaced with <span class="string">'implementation'</span> and <span class="string">'api'</span>.</span><br><span class="line">It will be removed at the end of 2018. For more information see: http://d.android.com/r/tools/update-dependency-configurations.html</span><br></pre></td></tr></table></figure>
<p>但我检查了APP项目以及所有的Module，都没有发现<code>compile</code>关键字，用全局搜索（command + shift + f）也没有查到，所以应该是某个远程依赖或插件中使用了<code>compile</code>关键字，但如何定位是哪一个呢？</p>
<p>通过IDE<code>Sync</code>后的提示如下：</p>
<img src="/2018/09/10/开发笔记-Complie关键字过时WARNING解决/warning1.png" title="Sync后的Warning提示">
<p><br></p>
<h1 id="问题分析和解决"><a href="#问题分析和解决" class="headerlink" title="问题分析和解决"></a>问题分析和解决</h1><p>IDE给的提示太简略，只能通过Gradle命令和<a href="https://docs.gradle.org/current/userguide/command_line_interface.html#sec:command_line_debugging" target="_blank" rel="noopener">Logging options</a>来打印详细的构建信息来定位问题。Logging级别从简略到详细依次为<code>-q</code>、<code>-w</code> 、<code>-i</code>、<code>-d</code>。IDE默认应该是使用<code>-q</code>的，可以逐级打印信息，也可以直接使用<code>-d</code>级别日志打印信息。</p>
<p>在项目根目录下，执行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew assembleDebug -d &gt; gradle.log</span><br></pre></td></tr></table></figure>
<p>其中<code>-d</code>是为了打印构建的Debug级别的信息，非常详细。由于信息非常多，命令行界面不能一屏完全显示，故放入名为<code>gradle.log</code>的文件中。</p>
<p>最后生成的文件有13M多，5万多行。通过搜索关键字”WARNING”，定位信息如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">16:03:26.459 [DEBUG] [org.gradle.internal.progress.DefaultBuildOperationExecutor] Build operation <span class="string">'Apply plugin com.sensorsdata.analytics.android to project '</span>:app<span class="string">''</span> started</span><br><span class="line">16:03:26.459 [WARN] [org.gradle.api.Project] WARNING: Configuration <span class="string">'compile'</span> is obsolete and has been replaced with <span class="string">'implementation'</span> and <span class="string">'api'</span>.</span><br><span class="line">It will be removed at the end of 2018. For more information see: http://d.android.com/r/tools/update-dependency-configurations.html</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>警告信息出现在”Build operation Apply plugin com.sensorsdata.analytics.android to project…”语句下，那很可能就是Gradle在应用这个插件的时候报的错。</p>
<p>插件是神策统计的，我的版本是<code>1.0.2</code>，查看官网给的<a href="https://dl.bintray.com/zouyuhan/maven" target="_blank" rel="noopener">Mavne库</a>，查看最新版本，<code>android-gradle-plugin2/</code>目录下，最高版本是<code>2.0.2</code>。</p>
<p>更新插件版本，重新构建，警告消失了，问题解决了。</p>
<blockquote>
<p>文章首发<a href="https://zhangliangnbu.github.io/" target="_blank" rel="noopener">我的个人博客</a>和<a href="https://www.jianshu.com/" target="_blank" rel="noopener">简书</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/04/学习Android构建系统（十一）-Android构建流程详解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhang Liang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://www.xda-developers.com/files/2013/12/android-code.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CodingForEverything">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/04/学习Android构建系统（十一）-Android构建流程详解/" itemprop="url">学习Android构建系统（十一）-Android构建流程详解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-04T13:53:41+08:00">
                2018-09-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习Android构建系统/" itemprop="url" rel="index">
                    <span itemprop="name">学习Android构建系统</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://juejin.im/post/5a69c0ccf265da3e2a0dc9aa" target="_blank" rel="noopener">https://juejin.im/post/5a69c0ccf265da3e2a0dc9aa</a></p>
<p><a href="https://blog.csdn.net/yanbober/article/details/49408489" target="_blank" rel="noopener">https://blog.csdn.net/yanbober/article/details/49408489</a></p>
<p><a href="https://jasonzhong.github.io/2017/06/27/Android-Apk%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/" target="_blank" rel="noopener">https://jasonzhong.github.io/2017/06/27/Android-Apk%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/</a></p>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>Android构建流程是指将Android项目转换成Apk（Android Application Package）这一过程，里面涉及到许多工步骤和<a href="https://developer.android.com/studio/command-line/" target="_blank" rel="noopener">工具</a>。构建流程由Gradle工具和Android Gradle Plugin插件来管理，既可以通过IDE方式，也可以通过命令行方式来进行。</p>
<h1 id="构建流程"><a href="#构建流程" class="headerlink" title="构建流程"></a>构建流程</h1><p>官网有一个简单的<a href="https://developer.android.com/studio/build/#build-process" target="_blank" rel="noopener">流程图</a>，如下：</p>
<img src="/2018/09/04/学习Android构建系统（十一）-Android构建流程详解/android_build_process_simple_2x.png" title="Android Build Process">
<p>比较简略，图中主要展示了两步，且都是由Gradle工具和Andorid插件管理的：</p>
<ol>
<li>编译。编译器将源代码编译成DEX文件和供前者直接使用的资源文件。</li>
<li>打包并签名。将上述DEX文件和资源文件合并成APK，之后进行签名生成最终可以用于安装、测试或发布的APK。</li>
</ol>
<p>在许多博客中，都提到一个<a href="http://androidsrc.net/android-app-build-overview/" target="_blank" rel="noopener">详细的流程图</a>，相关链接请见“参考”一节。都说是来自官网，但我没有找到，可能以前存在，现在已经删除了，如下：</p>
<img src="/2018/09/04/学习Android构建系统（十一）-Android构建流程详解/android_build_process_detail.png" title="Android Build Process">
<p>上述流程中涉及许多工具，如“aapt”、“aidl”等</p>
<p><br></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a href="http://www.herongyang.com/Android/Project-Android-Application-Project-Build-Process.html" target="_blank" rel="noopener">Android Application Project Build Process</a></li>
<li><a href="https://segmentfault.com/a/1190000008071324" target="_blank" rel="noopener">Android APK 编译打包流程</a></li>
<li><a href="https://cdn-images-1.medium.com/max/1600/1*LbKGyabN6vr-9iR-rvnzPg.png" target="_blank" rel="noopener">https://cdn-images-1.medium.com/max/1600/1*LbKGyabN6vr-9iR-rvnzPg.png</a></li>
<li><a href="https://juejin.im/entry/58b78d1b61ff4b006cd47e5b" target="_blank" rel="noopener">Apk 打包流程梳理-流程图较清晰</a></li>
<li><a href="https://segmentfault.com/a/1190000008071324" target="_blank" rel="noopener">https://segmentfault.com/a/1190000008071324</a></li>
<li><a href="https://segmentfault.com/a/1190000004916563" target="_blank" rel="noopener">https://segmentfault.com/a/1190000004916563</a></li>
<li><a href="https://juejin.im/post/5a69c0ccf265da3e2a0dc9aa" target="_blank" rel="noopener">https://juejin.im/post/5a69c0ccf265da3e2a0dc9aa</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/03/学习Android构建系统（十）-Android构建基础/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhang Liang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://www.xda-developers.com/files/2013/12/android-code.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CodingForEverything">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/03/学习Android构建系统（十）-Android构建基础/" itemprop="url">学习Android构建系统（十）-Android构建基础</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-03T18:01:20+08:00">
                2018-09-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习Android构建系统/" itemprop="url" rel="index">
                    <span itemprop="name">学习Android构建系统</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>大纲：简介、Androi Plugin &amp;  DSL Reference、常见Android项目构建脚本结构</p>
<p>挖坑，待续 :P</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/03/学习Android构建系统（九）-Gradle建议和总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhang Liang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://www.xda-developers.com/files/2013/12/android-code.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CodingForEverything">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/03/学习Android构建系统（九）-Gradle建议和总结/" itemprop="url">学习Android构建系统（九）-Gradle建议和总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-03T17:53:38+08:00">
                2018-09-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习Android构建系统/" itemprop="url" rel="index">
                    <span itemprop="name">学习Android构建系统</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>挖坑，待续 :P</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/03/学习Android构建系统（八）-Gradle问题排查和性能优化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhang Liang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://www.xda-developers.com/files/2013/12/android-code.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CodingForEverything">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/03/学习Android构建系统（八）-Gradle问题排查和性能优化/" itemprop="url">学习Android构建系统（八）-Gradle问题排查和性能优化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-03T17:50:46+08:00">
                2018-09-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习Android构建系统/" itemprop="url" rel="index">
                    <span itemprop="name">学习Android构建系统</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>大纲：</p>
<ol>
<li><p>简介</p>
</li>
<li><p>工具-Logging和Build Scan</p>
</li>
<li><p>Troubleshooting</p>
</li>
<li><p>性能优化</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Configuration <span class="string">'compile'</span> is obsolete and has been replaced with <span class="string">'implementation'</span> and <span class="string">'api'</span>.</span><br><span class="line">It will be removed at the end of 2018. For more information see: http://d.android.com/r/tools/update-dependency-configurations.html</span><br></pre></td></tr></table></figure>
<p>打印构建日志到文件中</p>
<p><a href="http://willis7.github.io/blog/2013/gradle-output-to-log.html" target="_blank" rel="noopener">http://willis7.github.io/blog/2013/gradle-output-to-log.html</a></p>
<p>挖坑，待续 :P</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/03/学习Android构建系统（七）-Gradle插件与内建任务/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhang Liang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://www.xda-developers.com/files/2013/12/android-code.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CodingForEverything">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/03/学习Android构建系统（七）-Gradle插件与内建任务/" itemprop="url">学习Android构建系统（七）-Gradle插件与内建任务</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-03T17:47:05+08:00">
                2018-09-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习Android构建系统/" itemprop="url" rel="index">
                    <span itemprop="name">学习Android构建系统</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>Gradle provides the core plugins (e.g. JavaPlugin) as part of its distribution which means they are automatically resolved</p>
</blockquote>
<p>挖坑，待续:p</p>
<p><br></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a href="https://docs.gradle.org/current/userguide/plugins.html#sec:using_plugins" target="_blank" rel="noopener">Using Gradle Plugins</a></li>
<li><a href="https://docs.gradle.org/current/userguide/standard_plugins.html" target="_blank" rel="noopener">Standard Gradle plugins</a></li>
<li><a href="https://docs.gradle.org/current/userguide/plugin_reference.html" target="_blank" rel="noopener">Core Plugin</a></li>
<li><a href="https://docs.gradle.org/current/userguide/custom_plugins.html" target="_blank" rel="noopener">Writing Custom Plugins</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/31/学习Android构建系统（六）-Gradle依赖管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhang Liang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://www.xda-developers.com/files/2013/12/android-code.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CodingForEverything">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/31/学习Android构建系统（六）-Gradle依赖管理/" itemprop="url">学习Android构建系统（六）-Gradle依赖管理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-31T15:03:18+08:00">
                2018-08-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习Android构建系统/" itemprop="url" rel="index">
                    <span itemprop="name">学习Android构建系统</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>依赖管理是一种以自动方式声明、解析和使用项目所需的依赖的技术。其中“依赖”的术语，官方定义如下：</p>
<blockquote>
<p>A dependency is a pointer to another piece of software required to build, test or run a <a href="https://docs.gradle.org/current/userguide/dependency_management_terminology.html#sub:terminology_module" target="_blank" rel="noopener">module</a></p>
<p>所以，依赖是指向软件模块的指针，而非模块本身</p>
</blockquote>
<p><strong>依赖管理流程</strong></p>
<ol>
<li>声明。在构建脚本中声明依赖和对应的仓库。</li>
<li>解析。项目构建时，Gradle会定位依赖的本地路径或远程服务器路径并下载依赖（有必须要的话）。</li>
<li>缓存。依赖解析后，Gradle会将从远程服务下载的依赖缓存到本地，避免下次构建时重复下载。</li>
</ol>
<p><strong>依赖是如何解析的</strong></p>
<ol>
<li><p>查找依赖指向的模块。根据仓库的类型，查找对应的描述模块的元数据属性文件（ (<code>.module</code>, <code>.pom</code> or <code>ivy.xml</code>) ）。</p>
<ul>
<li>如果依赖的版本号是动态的（如<code>1.+</code>），取最高的固定版本。</li>
<li>如果属性文件是POM文件则递归遍历父POM目录中的模块（？）。</li>
</ul>
</li>
</ol>
<ol start="2">
<li><p>选择模块。</p>
<ul>
<li>对于动态版本声明，选择最高的版本。</li>
</ul>
<ul>
<li>优先选择库中有属性文件定义的模块。</li>
<li>优先选择排序在前的库。</li>
<li>声明固定版本号的依赖并在库中定义了属性文件时，选择此依赖。</li>
</ul>
</li>
</ol>
<blockquote>
<p>注意：依赖的解析这块知识点，有些地方依旧不明晰，续详细研究</p>
</blockquote>
<p><br></p>
<h1 id="依赖与仓库"><a href="#依赖与仓库" class="headerlink" title="依赖与仓库"></a>依赖与仓库</h1><p><strong>依赖的几种类型</strong></p>
<ul>
<li><p>模块依赖（Module dependencies）。指向一个库中的模块，这是最常见的依赖类型。模块依赖的声明有两种方法：字符串表示法和map表示法，详细描述请见<a href="https://docs.gradle.org/current/dsl/org.gradle.api.artifacts.dsl.DependencyHandler.html" target="_blank" rel="noopener">DependencyHandler</a>和<a href="https://docs.gradle.org/current/javadoc/org/gradle/api/artifacts/ExternalModuleDependency.html" target="_blank" rel="noopener">ExternalModuleDependency</a> Reference。示例如下：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    <span class="comment">// map表示法</span></span><br><span class="line">    runtime <span class="string">group:</span> <span class="string">'org.springframework'</span>, <span class="string">name:</span> <span class="string">'spring-core'</span>, <span class="string">version:</span> <span class="string">'2.5'</span></span><br><span class="line">    <span class="comment">// 字符串表示法</span></span><br><span class="line">    runtime <span class="string">'org.springframework:spring-core:2.5'</span>,</span><br><span class="line">            <span class="string">'org.springframework:spring-aop:2.5'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>文件依赖。指向无需仓库的一系列文件。如</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    runtime files(<span class="string">'libs/a.jar'</span>, <span class="string">'libs/b.jar'</span>)</span><br><span class="line">    runtime fileTree(<span class="string">dir:</span> <span class="string">'libs'</span>, <span class="string">include:</span> <span class="string">'*.jar'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>项目依赖。指向多项目工程主项目需要用到的其他项目，声明如下：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile project(<span class="string">':shared'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>特定分发的依赖。如API依赖、TestKit依赖和本地Groovy依赖等。</p>
</li>
</ul>
<p><strong>常见的仓库</strong></p>
<ul>
<li><a href="https://docs.gradle.org/current/userguide/repository_types.html#sec:flat_dir_resolver" target="_blank" rel="noopener">文件系统仓库</a>。通过查找文件目录以解析依赖。</li>
<li><a href="https://mvnrepository.com/repos/central" target="_blank" rel="noopener">Maven Central 仓库</a>。一般默认的Maven仓库。</li>
<li><a href="https://jfrog.com/" target="_blank" rel="noopener">JCenter Maven 仓库</a>。Android默认的Maven仓库。</li>
<li><a href="https://dl.google.com/dl/android/maven2/index.html" target="_blank" rel="noopener">Google Maven 仓库</a>。Google的支持库所在的Maven仓库。</li>
<li><a href="https://docs.gradle.org/current/userguide/repository_types.html#sub:maven_local" target="_blank" rel="noopener">本地 Maven仓库</a>。就是你开发项目所用的主机中的仓库。</li>
<li><a href="https://docs.gradle.org/current/userguide/repository_types.html#sub:maven_repo" target="_blank" rel="noopener">自定义Maven仓库</a>。一些公司，如阿里，喜欢把阿里云云OSS服务SDK等存储在自己搭建的Maven仓库中。</li>
<li><a href="https://docs.gradle.org/current/userguide/repository_types.html#sec:ivy_repositories" target="_blank" rel="noopener">Ivy仓库</a>。不常用，不解释，自己看文档。</li>
</ul>
<blockquote>
<p>Maven仓库是用<a href="https://maven.apache.org/index.html" target="_blank" rel="noopener">Apache Maven</a>工具搭建的存储不同类型资源的本地或远程资源服务。Maven Central仓库、JCenter Maven仓库和Google Maven仓库都是Maven仓库，区别在于存储的服务器和管理的机构不一样。</p>
</blockquote>
<p><br></p>
<h1 id="依赖传递和冲突解决"><a href="#依赖传递和冲突解决" class="headerlink" title="依赖传递和冲突解决"></a>依赖传递和冲突解决</h1><p>待续</p>
<p><br></p>
<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><p>待续</p>
<blockquote>
<p>这章写的比较马虎，但就这样吧，以后有时间再做详细的研究。</p>
</blockquote>
<p><br></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a href="https://docs.gradle.org/current/userguide/introduction_dependency_management.html" target="_blank" rel="noopener">Introduction to Dependency Management</a></li>
<li><a href="https://docs.gradle.org/current/userguide/dependency_types.html" target="_blank" rel="noopener">Dependency Types</a></li>
<li><a href="https://docs.gradle.org/current/userguide/repository_types.html" target="_blank" rel="noopener">Repository Types</a></li>
<li><a href="https://maven.apache.org/index.html" target="_blank" rel="noopener">Apache Maven</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/28/学习Android构建系统（五）-Gradle的Wrapper、命令行和环境配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhang Liang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://www.xda-developers.com/files/2013/12/android-code.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CodingForEverything">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/28/学习Android构建系统（五）-Gradle的Wrapper、命令行和环境配置/" itemprop="url">学习Android构建系统（五）-Gradle的Wrapper、命令行和环境配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-28T16:12:25+08:00">
                2018-08-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习Android构建系统/" itemprop="url" rel="index">
                    <span itemprop="name">学习Android构建系统</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>这三个知识点不难，但经常用到，如果不看官方文档，有时候并不知道怎么使用，出现问题也不知道原因，所以有必要做一个总结。由于每个知识点都不多，又有关联，所以放在同一节。</p>
<h1 id="Gradle-Wrapper"><a href="#Gradle-Wrapper" class="headerlink" title="Gradle Wrapper"></a>Gradle Wrapper</h1><p>Gradle Wrapper（以下简写为“Wrapper”）用于管理当前项目的Gradle版本，Gradle官方强烈推荐使用Wrapper构建项目。多人协作时，必须规定项目的Gradle版本，并以此版本的Gradle作为项目的构建工具，由于每个人在本地安装的Gradle版本可能并不一致（也没有必要一致），因此有必要在项目中统一管理Gradle版本。</p>
<p>Wrapper的文件结构如下（项目根目录中）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">├── build.gradle</span><br><span class="line">├── settings.gradle</span><br><span class="line">├── gradle</span><br><span class="line">│   └── wrapper</span><br><span class="line">│       ├── gradle-wrapper.jar</span><br><span class="line">│       └── gradle-wrapper.properties</span><br><span class="line">├── gradlew</span><br><span class="line">└── gradlew.bat</span><br></pre></td></tr></table></figure>
<p>包括一个gradle文件和两个可执行的脚本文件gradlew（macOS等平台用）和gradlew.bat（Windows平台用）。</p>
<ul>
<li><code>gradle-wrapper.jar</code>。用于下载所需版本的Gradle。</li>
<li><code>gradle-wrapper.properties</code>。配置Gradle的版本号、本地存储地址等。各属性说明请见<a href="https://docs.gradle.org/current/userguide/gradle_wrapper.html#sec:adding_wrapper" target="_blank" rel="noopener">官方文档</a>。</li>
<li><code>gradlew</code>, <code>gradlew.bat</code>。Wrapper的执行脚本，用于替代<code>gradle</code>命令来构建项目。</li>
</ul>
<blockquote>
<p>注意：<code>gradle-wrapper.properties</code>中有一个<code>distributionUrl</code>属性，用于定义Gradle版本地下载URL，如<code>distributionUrl=https\://services.gradle.org/distributions/gradle-4.0-all.zip</code>，版本号后面有个“-all”，有时你也可能看到“-bin”，是什么意思呢？”-all”表示会下载此版本Gralde的所有的资源，包括二进制运行时文件、示例代码和相关文档。“-bin”表示只下载二进制运行时文件。</p>
</blockquote>
<p>Wrapper 构建项目时，其工作流程如下：</p>
<ol>
<li>检查规定的Gradle版本，如果没有则去服务器下载。</li>
<li>下载的Gradle版本存储在Gradle的用户目录中。如macOS中默认存储所有的Gradle版本到<code>/Users/yourname/.gradle/wrapper/dists/</code>中。</li>
<li>使用解压后的Gradle版本来构建项目。</li>
</ol>
<p><img src="https://docs.gradle.org/current/userguide/img/wrapper-workflow.png" alt="wrapper workflow"></p>
<p><strong>添加Wrapper</strong></p>
<p>使用命令行添加Wrapper有两种方式：</p>
<ol>
<li>使用<code>gradle init</code>创建新项目，则会初始化一个带有Wrapper的Gradle项目。</li>
<li>使用<code>gradle wrapper</code>在旧的项目中添加Wrapper。</li>
</ol>
<blockquote>
<p><code>wrapper</code>是Gradle的内建任务</p>
</blockquote>
<p>一般的IDE创建项目时都会自动生产Wrapper文件，如Android Studio。</p>
<p><strong>使用Wrapper执行任务</strong></p>
<p>用Wrapper脚本替换掉<code>gradle</code>来执行任务即可。以macOS平台为例，在项目根目录下执行<code>./gradlew [task name]</code>即可，如列出当前项目的所有任务，项目根目录下执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./gradlew tasks</span><br></pre></td></tr></table></figure>
<p><strong>更新Wrapper</strong></p>
<p>有两种方式更新Wrapper</p>
<ol>
<li>命令行方法。<code>.gradlew wrapper --gradle-version [要更新的版本号]</code>。</li>
<li>修改<code>gradle/wrapper/gradle-wrapper.properties</code>中的<code>distributionUrl</code>属性。</li>
</ol>
<p><br></p>
<h1 id="Gradle命令行"><a href="#Gradle命令行" class="headerlink" title="Gradle命令行"></a>Gradle命令行</h1><p>与Gradle交互有两种方式，一是<a href="https://docs.gradle.org/current/userguide/command_line_interface.html" target="_blank" rel="noopener">命令行界面</a>，二是IDE的图形界面，如Android Studio。IDE方式各有不同且未必包括所有的命令行指令，但命令行方式却是不变的，因此需要学会基本的命令行指令，以不变应万变。</p>
<blockquote>
<p>注意：在项目中使用命令行方式时，推荐使用<code>./gradlew</code> or <code>gradlew.bat</code> 来代替 <code>gradle</code>。示例中为了方便，统一使用<code>gradle</code></p>
</blockquote>
<p>命令行指令可以自定义，参见<a href="https://docs.gradle.org/current/userguide/custom_tasks.html#sec:declaring_and_using_command_line_options" target="_blank" rel="noopener">declaring_and_using_command_line_options</a></p>
<p><strong>指令形式</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle [taskName...] [--option-name...]</span><br></pre></td></tr></table></figure>
<p>说明</p>
<ul>
<li><p>任务名（taskName）有多个时，使用空格分开，如<code>gradle task1 task2</code></p>
</li>
<li><p>在多项目工程中，执行某个项目的任务时，可以用“:”将项目名添加到任务名之前，如</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> gradle projectName:taskName</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> gradle :projectName:taskName</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>可选项（option-name）如果接收参数，建议使用<code>=</code>拼接，如</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> gradle task1 --console=plain</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>可选项规定一个行为时，可使用<code>--no-</code>作为其全称（long-form）前缀，来指定它的对立行为。如</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--build-cache</span><br><span class="line">--no-build-cache</span><br></pre></td></tr></table></figure>
</li>
<li><p>可选项的全称名称常有简写形式 ，如</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--help</span><br><span class="line">-h</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong><a href="https://docs.gradle.org/current/userguide/command_line_interface.html#common_tasks" target="_blank" rel="noopener">常见内建（built-in）任务指令</a></strong></p>
<ul>
<li><code>gradle build</code>。生成所有的输出，并执行所有的检查。</li>
<li><code>gradle run</code>。生成应用程序并执行某些脚本或二进制文件</li>
<li><code>gradle check</code>。执行所有检测类任务如tests、linting等</li>
<li><code>gradle clean</code>。删除build文件目录。</li>
<li><code>gradle projects</code>。查看项目结构。</li>
<li><code>gradle tasks</code>。查看任务列表。查看某个任务详细信息，可用<code>gradle help --task someTask</code></li>
<li><code>gradle dependencies</code>。查看依赖列表。</li>
</ul>
<p>部分常见命令行选项说明如下：</p>
<p><strong>调试类</strong></p>
<ul>
<li><code>-?</code>, <code>-h</code>, <code>--help</code>。查看帮助信息。</li>
<li><code>-v</code>,<code>--version</code>。查看版本信息。</li>
<li><code>-s</code>,<code>--stacktrace</code>。执行任务时，打印栈信息。如<code>gradle build --s</code></li>
</ul>
<p>其他选项说明见官方文档<a href="https://docs.gradle.org/current/userguide/command_line_interface.html#sec:command_line_debugging" target="_blank" rel="noopener">Debugging options</a></p>
<p><strong>日志类</strong></p>
<ul>
<li><code>-q</code>, <code>--quiet</code>。只打印errors类信息。</li>
<li><code>-i</code>, <code>--info</code>。打印详细的信息。</li>
</ul>
<p>其他选项说明见官方文档<a href="https://docs.gradle.org/current/userguide/command_line_interface.html#setting_log_level" target="_blank" rel="noopener">Logging options</a>，更多关于日志类描述请见<a href="https://docs.gradle.org/current/userguide/logging.html#logging" target="_blank" rel="noopener">Logging</a>。</p>
<p><strong>性能类</strong></p>
<p>用于优化构建的性能</p>
<ul>
<li><code>--configure-on-demand</code>,<code>--no-configure-on-demand</code>。是否开启按需配置模式。</li>
<li><code>--build-cache</code>, <code>--no-build-cache</code>。是否使用缓存。</li>
</ul>
<p>其他选项说明见官方文档<a href="https://docs.gradle.org/current/userguide/command_line_interface.html#sec:command_line_performance" target="_blank" rel="noopener">Performance Options</a>，更多关于性能优化方面的描述请见 <a href="https://guides.gradle.org/performance/" target="_blank" rel="noopener">improving performance of Gradle builds here</a>.</p>
<p><strong>环境配置类</strong></p>
<p>用于配置构建时的环境</p>
<ul>
<li><code>-c</code>, <code>--settings-file</code>。如果不用默认的<code>settings.gradle</code>时，可指定Setting文件。</li>
<li><code>-b</code>, <code>--build-file</code>。指定构建文件。</li>
<li><code>-Dorg.gradle.jvmargs</code>。设置JVM参数。</li>
</ul>
<p>其他选项说明见官方文档<a href="https://docs.gradle.org/current/userguide/command_line_interface.html#environment_options" target="_blank" rel="noopener">Environment options</a>，更多关于环境配置方面的描述请见<a href="https://docs.gradle.org/current/userguide/build_environment.html#build_environment" target="_blank" rel="noopener">build environment</a></p>
<p><br></p>
<h1 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h1><p><a href="https://docs.gradle.org/current/userguide/build_environment.html" target="_blank" rel="noopener">配置构建环境</a>，主要配置Gradle构建参数和对应的JVM参数，如代理策略等。其目的是为了多人协作时，保持在一致的环境下进行项目开发。</p>
<p>配置环境有几种途径，优先级从高往低，列出如下：</p>
<ol>
<li>命令行。</li>
<li><code>GRADLE_USER_HOME</code>目录中的<code>gradle.properties</code>文件。</li>
<li>项目根目录中的<code>gradle.properties</code>文件。</li>
<li>环境变量。运行Gradle环境的变量，如JAVA_HOME等。</li>
</ol>
<p>配置环境其实是设置各种属性参数，以上四种方式对于某些属性都可以配置。其中命令行和<code>gradle.properties</code>文件方式支持所有属性的配置。属性有不同的级别，按照优先级从高到底列出如下：</p>
<ol>
<li>系统属性（System properties）。</li>
<li>Gradle属性。</li>
</ol>
<p><strong>系统属性</strong></p>
<p>用于设置Gradle的JVM环境。</p>
<ol>
<li>命令行方式。通过给属性添加<code>-D</code>前缀来设置。如<code>gradle -Dgradle.user.home=foo</code></li>
<li><code>gradle.properties</code>文件方式。根目录中，为属性添加<code>systemProp.</code>前缀，如<code>systemProp.gradle.wrapperUser=myuser</code></li>
</ol>
<p>几个系统属性如下：</p>
<ul>
<li><code>gradle.wrapperUser=(myuser)</code>。设置Wrapper下载Gradle版本的代理服务器的用户名。</li>
<li><code>gradle.wrapperPassword=(mypassword)</code>。设置Wrapper下载Gradle版本的代理服务器的密码。</li>
<li><code>gradle.user.home=(path to directory)</code>。设置Gradle用户目录地址。</li>
</ul>
<p><strong>Gradle属性</strong></p>
<p>Gradle属性都有对应的命令行方式，<code>gradle.properties</code>文件属性和对应的命令行如下：</p>
<table>
<thead>
<tr>
<th><code>gradle.properties</code>文件属性</th>
<th style="text-align:left">命令行指令</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>org.gradle.caching=(true,false)</code></td>
<td style="text-align:left"><code>--build-cache</code>,  <code>--no-build-cache</code></td>
</tr>
<tr>
<td><code>org.gradle.caching.debug=(true,false)</code></td>
<td style="text-align:left">?</td>
</tr>
<tr>
<td><code>org.gradle.configureondemand=(true,false)</code></td>
<td style="text-align:left"><code>--configure-on-demand</code>, <code>--no-configure-on-demand</code></td>
</tr>
<tr>
<td><code>org.gradle.console=(auto,plain,rich,verbose)</code></td>
<td style="text-align:left"><code>--console=(auto,plain,rich,verbose)</code></td>
</tr>
<tr>
<td><code>org.gradle.daemon=(true,false)</code></td>
<td style="text-align:left"><code>--daemon</code>, <code>--no-daemon</code></td>
</tr>
<tr>
<td><code>org.gradle.daemon.idletimeout=(# of idle millis)</code></td>
<td style="text-align:left"><code>-Dorg.gradle.daemon.idletimeout=(number of milliseconds)</code></td>
</tr>
<tr>
<td><code>org.gradle.debug=(true,false)</code></td>
<td style="text-align:left"><code>-Dorg.gradle.debug=（true,false)</code></td>
</tr>
<tr>
<td><code>org.gradle.java.home=(path to JDK home)</code></td>
<td style="text-align:left"><code>-Dorg.gradle.java.home</code></td>
</tr>
<tr>
<td><code>org.gradle.jvmargs=(JVM arguments)</code></td>
<td style="text-align:left"><code>-Dorg.gradle.jvmargs</code></td>
</tr>
<tr>
<td><code>org.gradle.logging.level=(quiet,warn,lifecycle,info,debug)</code></td>
<td style="text-align:left"><code>-Dorg.gradle.logging.level=(quiet,warn,lifecycle,info,debug)</code>或者 <code>-q</code>、<code>-w</code>、<code>-i</code>、<code>-d</code></td>
</tr>
<tr>
<td><code>org.gradle.parallel=(true,false)</code></td>
<td style="text-align:left"><code>--parallel</code>, <code>--no-parallel</code></td>
</tr>
<tr>
<td><code>org.gradle.warning.mode=(all,none,summary)</code></td>
<td style="text-align:left"><code>-Dorg.gradle.warning.mode=(all,none,summary)</code> 或者<code>--warning-mode=(all,none,summary)</code></td>
</tr>
<tr>
<td><code>org.gradle.workers.max=(max # of worker processes)</code></td>
<td style="text-align:left"><code>--max-workers</code></td>
</tr>
</tbody>
</table>
<p>详细说明请见<a href="https://docs.gradle.org/current/userguide/build_environment.html#sec:gradle_configuration_properties" target="_blank" rel="noopener">Gradle properties</a></p>
<p>另外官网中有项目属性和通过项目属性配置任务的说明，这里不做描述，请见官网<a href="https://docs.gradle.org/current/userguide/build_environment.html#sec:project_properties" target="_blank" rel="noopener">Project properties</a></p>
<p><strong>示例-设置JVM参数</strong></p>
<p>对于每个Java虚拟机进程，Gradle默认配置堆空间最大为1024MB（<code>-Xmx1024m</code>）。-Xmx1024m根据项目大小，可以修改这一参数。如果使用了Gradle Daemon（<code>org.gradle.daemon=true</code>，默认开启），则配置参数如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.gradle.jvmargs=-Xmx2g -XX:MaxPermSize=256m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8</span><br></pre></td></tr></table></figure>
<p>Java虚拟机参数设置参考Java HotSpot VM Options：<a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html" target="_blank" rel="noopener">Java 8及以上</a>，<a href="http://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html" target="_blank" rel="noopener">Java 7参考</a>。上面的参数说明如下：</p>
<ul>
<li><p><code>-Xmx[size]</code>。设置虚拟机最大内存空间。必须是1024的倍数，且不能小于2MB，单位为k/K、m/M、g/G，默认值随系统配置而变。与<code>XX:MaxHeapSize</code>等价。示例80MB：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-Xmx83886080</span><br><span class="line">-Xmx81920k</span><br><span class="line">-Xmx80m</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>-XX:MaxPermSize=[size]</code>。设置持久代最大空间，持久代用于存储常量等，如果报<code>java.lang.OutOfMemoryError: PermGen space</code>的异常，则需要增加这一空间。</p>
<blockquote>
<p>Java虚拟机内存划分请见Oracle官方文档<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/generations.html" target="_blank" rel="noopener">Generations</a></p>
</blockquote>
</li>
<li><p><code>-XX:-HeapDumpOnOutOfMemoryError</code>。当抛出<code>java.lang.OutOfMemoryError</code>异常时，将堆内容存储到文件中，用于调试。</p>
</li>
<li><p><code>-Dfile.encoding=UTF-8</code>。虚拟机编码格式。</p>
<blockquote>
<p>在参考文档中并没有找到<code></code>-Dfile.encoding`设置</p>
</blockquote>
</li>
</ul>
<p><strong>示例-设置代理</strong></p>
<p>国内下载依赖和Google资源时有时候速度很慢，可以通过设置HTTP和HTTPS代理服务解决。在<code>gradle.properties</code>中设置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># http代理</span><br><span class="line">systemProp.http.proxyHost=www.somehost.org</span><br><span class="line">systemProp.http.proxyPort=8080</span><br><span class="line">systemProp.http.proxyUser=userid</span><br><span class="line">systemProp.http.proxyPassword=password</span><br><span class="line">systemProp.http.nonProxyHosts=*.nonproxyrepos.com|localhost</span><br><span class="line"></span><br><span class="line"># https代理</span><br><span class="line">systemProp.https.proxyHost=www.somehost.org</span><br><span class="line">systemProp.https.proxyPort=8080</span><br><span class="line">systemProp.https.proxyUser=userid</span><br><span class="line">systemProp.https.proxyPassword=password</span><br><span class="line">systemProp.https.nonProxyHosts=*.nonproxyrepos.com|localhost</span><br></pre></td></tr></table></figure>
<p>如果没有user和password，可以不用写。</p>
<p>其他的代理参数可以参考Java文档<a href="https://docs.oracle.com/javase/7/docs/technotes/guides/net/properties.html" target="_blank" rel="noopener">Networking Properties</a></p>
<p><br></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a href="https://docs.gradle.org/current/userguide/gradle_wrapper.html" target="_blank" rel="noopener">Gradle官网-Gradle Wrapper</a></li>
<li><a href="https://docs.gradle.org/current/userguide/command_line_interface.html" target="_blank" rel="noopener">Gradle官网-Command-Line Interface</a></li>
<li><a href="https://docs.gradle.org/current/userguide/build_environment.html" target="_blank" rel="noopener">Gradle官网-Build Environment</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/27/学习Android构建系统（四）-Gradle构建流程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhang Liang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://www.xda-developers.com/files/2013/12/android-code.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CodingForEverything">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/27/学习Android构建系统（四）-Gradle构建流程/" itemprop="url">学习Android构建系统（四）-Gradle构建流程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-27T20:24:50+08:00">
                2018-08-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习Android构建系统/" itemprop="url" rel="index">
                    <span itemprop="name">学习Android构建系统</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="构建的生命周期"><a href="#构建的生命周期" class="headerlink" title="构建的生命周期"></a>构建的生命周期</h1><p>Gradle项目的构建分为三个阶段：初始化、配置、执行。<br>参考官方手册 <a href="https://docs.gradle.org/current/userguide/build_lifecycle.html" target="_blank" rel="noopener">Build Lifecycle</a>。</p>
<h2 id="初始化（Initialization）"><a href="#初始化（Initialization）" class="headerlink" title="初始化（Initialization）"></a>初始化（Initialization）</h2><p>在这个阶段中，Gradle决定哪些项目加入到构建中（因为Gradle支持多项目构建），并为这些项目分别创建一个<code>Project</code>实例。</p>
<p>Gradle支持单项目和多项目构建，如果是单项目构建，则初始化当前项目即可，如果是多项目构建，则需要决定哪些项目需要加入到构建中并初始化。那么：</p>
<ol>
<li>Gradle是如何判断当前构建是单项目还是多项目构建呢？</li>
<li>如果是多项目构建，Gradle又是如何决定将哪些项目加入到构建中呢？</li>
</ol>
<p><strong>多项目还是单项目构建？</strong><br>这里的关键是一个名为<code>setting.gradle</code>的文件，Gradle在初始化阶段会首先去查找<code>setting.gradle</code>文件，查找的规则如下：</p>
<ol>
<li>查找当前构建目录下的<code>setting.gradle</code>文件。</li>
<li>如果没有找到，则去与当前目录有相同嵌套级别的<code>master</code>目录查找。</li>
<li>如果没有找到，则去父目录查找。</li>
<li>如果没有找到，则进行单项目构建。</li>
<li>如果找到了，Gradle去检查当前项目在<code>settings.gradle</code>中是否有定义。如果没有，则进行单项目构建，否则进行多项目构建。</li>
</ol>
<p>多项目工程在根目录必须存在<code>setting.gradle</code>文件，单项目工程则可以不需要这个文件。</p>
<p><strong>多项目构建的项目集如何决定？</strong><br>多项目构建时，项目集由<code>setting.gradle</code>创建。项目集可以用一个树形结构表示，每个节点表示一个项目，并且有对应的项目路径。在大多数情况下，项目路径与文件系统中项目的位置一致，当然这也是可以配置的。<br>在<code>setting.gradle</code>中，有很多方法可以定义项目树，常见的是层次化和扁平化的布局。</p>
<p>层次化布局<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setting.gradle</span></span><br><span class="line">include <span class="string">'project1'</span>, <span class="string">'project2:child'</span>, <span class="string">'project3:child1'</span></span><br></pre></td></tr></table></figure></p>
<p><code>include</code>方法接收多个项目路径作为参数。<br>每个项目路径对应文件系统中的一个目录，通常，项目路径和文件目录一一对应，比如<code>project2:child</code>对应项目根目录下的<code>project2/child</code>目录。<br>如果项目树的叶子节点和它的父节点都需要包含在构建中，则只需指定叶子节点即可。比如，<code>project2:child</code>，将创建两个项目实例<code>project2</code>和<code>project2:child</code>。</p>
<p>扁平化布局<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setting.gradle</span></span><br><span class="line">includeFlat <span class="string">'project3'</span>, <span class="string">'project4'</span></span><br></pre></td></tr></table></figure></p>
<p><code>includeFlat</code>方法将目录名作为参数。这些目录是根项目目录的兄弟目录，并作为多项目树中根项目的子项目。</p>
<p><strong>Settings语法</strong><br>这里主要说一下<code>include</code>方法的语法，其余的语法请见对应的<a href="https://docs.gradle.org/current/dsl/org.gradle.api.initialization.Settings.html" target="_blank" rel="noopener">DSL Reference</a>。<code>setting.gradle</code>在构建时会创建代理对象<code>Settings</code>，其<code>include</code>方法对应着 <code>Settings.include(java.lang.String[])</code>，查看其<a href="https://docs.gradle.org/current/dsl/org.gradle.api.initialization.Settings.html#org.gradle.api.initialization.Settings:include(java.lang.String[]" target="_blank" rel="noopener">DSL Reference</a>):</p>
<ol>
<li><code>include</code>方法接收项目路径数组作为参数，并将对应的项目添加到构建中。</li>
<li>参数中支持的项目路径分隔符为“:”，而不是“/”。</li>
<li>路径的最后一个节点是项目的名称。</li>
<li>项目路径是根项目目录下的相对路径，可以使用<a href="https://docs.gradle.org/current/javadoc/org/gradle/api/initialization/ProjectDescriptor.html#setProjectDir-java.io.File-" target="_blank" rel="noopener"><code>ProjectDescriptor.setProjectDir(java.io.File)</code></a>)更改。</li>
</ol>
<p>示例<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入两个项目, 'foo' and 'foo:bar'</span></span><br><span class="line"><span class="comment">// 对应的文件目录是 $rootDir/a 和 $rootDir/a/b</span></span><br><span class="line"><span class="comment">// directories are inferred by replacing ':' with '/'</span></span><br><span class="line">include <span class="string">'foo:bar'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// include one project whose project dir does not match the logical project path</span></span><br><span class="line"><span class="comment">// 引入‘baz’项目，对应的文件目录是foo/baz</span></span><br><span class="line">include <span class="string">'baz'</span></span><br><span class="line">project(<span class="string">':baz'</span>).projectDir = file(<span class="string">'foo/baz'</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="配置（Configuration）"><a href="#配置（Configuration）" class="headerlink" title="配置（Configuration）"></a>配置（Configuration）</h2><p>在这个阶段，Gradle会配置加入到构建中的<code>Project</code>实例，执行所有项目对应的构建脚本。</p>
<blockquote>
<p>作为名词的‘配置（Configuration）’是指，Gradle执行项目的构建脚本这一过程。<br>作为动词的’配置（ Configure）’是指，Gradle执行项目的构建脚本这一动作。</p>
</blockquote>
<p><strong>默认配置模式</strong></p>
<p>默认情况下，Gradle会配置<code>settings.gradle</code>里的所有项目，不论这些项目与最终执行的任务是否有关系。这样做是因为Gradle允许一个项目在配置和执行阶段访问任何其他项目，如Gradle里可以进行<a href="https://docs.gradle.org/current/userguide/multi_project_builds.html#sec:cross_project_configuration" target="_blank" rel="noopener">跨项目配置(Cross project configuration)</a>，一个项目的配置可能会依赖其他项目，所以在执行任务之前，需要配置所有的项目。</p>
<p>项目配置按照广度（ breadth-wise）顺序来执行，如父项目先于子项目被配置。</p>
<p><strong>按需配置模式</strong></p>
<p>由于多项目配置中，可能存在大量无需配置的项目，如果需要配置所有项目后才执行任务则会浪费大量的时间。从Gradle1.4开始，有一个孵化中的特性，叫做<a href="https://docs.gradle.org/current/userguide/multi_project_builds.html#sec:cross_project_configuration" target="_blank" rel="noopener">按需配置（configuration on demand）</a>模式。按需配置项目时，Gradle只配置与最终任务相关联的项目，以缩短构建时间。这个模式以后可能会成为默认模式，甚至成为唯一的模式。截至我写这篇文章（Gradle发布4.10）时，按需配置模式还只是一个实验中的特性，不能保证所有的构建都能正确运行，尤其是存在耦合的多项目构建。</p>
<blockquote>
<p>项目的耦合和解耦请见文档的<a href="https://docs.gradle.org/current/userguide/multi_project_builds.html#sec:decoupled_projects" target="_blank" rel="noopener">Decoupled Projects</a>。一个简单的耦合项目就是在子项目中使用<code>allprojects</code> and <code>subprojects</code>等方法，在根项目中使用这两个方法则不会影响按需配置模式。</p>
</blockquote>
<p>按需配置模式下，项目配置遵循规则如下：</p>
<ul>
<li>根项目总会被配置。</li>
<li>构建的当前项目也会被配置。</li>
<li>项目的依赖会被配置。如果项目A将项目B作为依赖，则构建A时，A和B都会被配置。</li>
<li>任务依赖对应的项目会被配置。如’someTask.dependsOn(“:someOtherProject:someOtherTask”)‘，someOtherProject会被配置。</li>
<li>通过命令行构建任务时会配置相应的项目。如构建 ‘projectA:projectB:someTask’时会配置projectB。</li>
</ul>
<p>进行构建时，可以在命令行加入<code>--configure-on-demand</code>来指定用按需配置模式来进行构建，如<code>gradle hello --configure-on-demand</code>将以按需配置模式执行‘’hello“任务。</p>
<h2 id="执行（Execution）"><a href="#执行（Execution）" class="headerlink" title="执行（Execution）"></a>执行（Execution）</h2><p>在这个阶段，首先，Gradle确定要执行的任务集，任务集是由输入到命令行的任务名称参数和当前目录决定的。然后，Gradle会去执行任务集中的每个任务。<br>任务（<code>Task</code>）是由一系列的活动（<code>Action</code>）组成的，当任务执行的时候，活动会依次执行。可以通过<code>doFirst</code>和<code>doLast</code>方法将活动添加到任务中。</p>
<p>问题：</p>
<ol>
<li>多项目构建中，Gradle如何确定任务是哪个项目的？尤其是任务名称相同的情况下。</li>
<li>如果确定多个任务执行的顺序？</li>
</ol>
<p><strong>任务的位置</strong><br>以<code>$ gradle hello</code>为例，在执行阶段，Gradle会从构建的当前项目目录开始，依据项目树往下查找名称为<code>hello</code>的任务并执行。因此Gradle不会执行当前项目的父项目和兄弟节点项目的任务。</p>
<p><strong>任务的顺序</strong><br>如果没有额外配置，Gradle将以字母数字顺序执行任务。比如 “:consumer:action” 将先于 “:producer:action”执行。</p>
<blockquote>
<p>If nothing else is defined, Gradle executes the task in alphanumeric order</p>
</blockquote>
<p><br></p>
<h1 id="示例-单项目构建"><a href="#示例-单项目构建" class="headerlink" title="示例-单项目构建"></a>示例-单项目构建</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建项目目录</span></span><br><span class="line">$ mkdir single-project-build-lifecycle-demo</span><br><span class="line">$ <span class="built_in">cd</span> single-project-build-lifecycle-demo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建settings.gradle文件</span></span><br><span class="line">$ vi settings.gradle</span><br></pre></td></tr></table></figure>
<p><code>settings.gradle</code>文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rootProject.name = &apos;single-project-build-lifecycle-demo&apos;</span><br><span class="line">println &apos;settings.gradle -&gt; this is executed during the initialization phase.&apos;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建build.gradle文件</span></span><br><span class="line">$ vi build.gradle</span><br></pre></td></tr></table></figure>
<p><code>build.gradle</code>文件</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">println <span class="string">'build.gradle -&gt; global println -&gt; This is executed during the configuration phase.'</span></span><br><span class="line"></span><br><span class="line">task configured &#123;</span><br><span class="line">    println <span class="string">'build.gradle -&gt; task configured -&gt; This is also executed during the configuration phase.'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task test &#123;</span><br><span class="line">    doLast &#123;</span><br><span class="line">        println <span class="string">'build.gradle -&gt; task test -&gt; doLast -&gt; This is executed during the execution phase.'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task testBoth &#123;</span><br><span class="line">    doFirst &#123;</span><br><span class="line">      println <span class="string">'build.gradle -&gt; task testBoth -&gt; doFirst -&gt; This is executed first during the execution phase.'</span></span><br><span class="line">    &#125;</span><br><span class="line">    doLast &#123;</span><br><span class="line">      println <span class="string">'build.gradle -&gt; task testBoth -&gt; doLast -&gt; This is executed last during the execution phase.'</span></span><br><span class="line">    &#125;</span><br><span class="line">    println <span class="string">'build.gradle -&gt; task testBoth -&gt; This is executed during the configuration phase as well.'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>开始构建，并执行testBoth任务 <code>$ gradle testBoth</code>，输出如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">settings.gradle -&gt; this is executed during the initialization phase.</span><br><span class="line"></span><br><span class="line">&gt; Configure project :</span><br><span class="line">build.gradle -&gt; global println -&gt; This is executed during the configuration phase.</span><br><span class="line">build.gradle -&gt; task configured -&gt; This is also executed during the configuration phase.</span><br><span class="line">build.gradle -&gt; task testBoth -&gt; This is executed during the configuration phase as well.</span><br><span class="line"></span><br><span class="line">&gt; Task :testBoth</span><br><span class="line">build.gradle -&gt; task testBoth -&gt; doFirst -&gt; This is executed first during the execution phase.</span><br><span class="line">build.gradle -&gt; task testBoth -&gt; doLast -&gt; This is executed last during the execution phase.</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL <span class="keyword">in</span> 0s</span><br><span class="line">1 actionable task: 1 executed</span><br></pre></td></tr></table></figure>
<p>构建过程如下：</p>
<ol>
<li><p>初始化阶段。<br>执行<code>settings.gradle</code>脚本，所以首先输出’settings.gradle -&gt; this is executed during the initialization phase.’。</p>
</li>
<li><p>配置阶段。<br>由于<code>settings.gradle</code>没有定义项目，根项目即当前项目有<code>build.gradle</code>，因此只是执行这个文件。顺序执行：打印语句、三个task方法。<br>这里的三个task方法对应<code>Project</code>实例中<code>Task task(String name, Closure configureClosure)</code>，查看其<a href="https://docs.gradle.org/current/dsl/org.gradle.api.Project.html#org.gradle.api.Project:task(java.lang.String,%20groovy.lang.Closure" target="_blank" rel="noopener">Reference文档</a>)，说是这个方法会产生一个任务对象并添加到当前<code>Project</code>实例中，并且在返回这个任务的时候会执行闭包以配置这个任务。也就说在配置我们这个项目时，三个<code>task</code>方法的闭包都会被执行。<br>以testBoth任务对应的<code>task</code>方法为例，它的闭包里包含<code>doFirst</code>、<code>doLast</code>和<code>println</code>三个方法。其中<code>doFirst</code>和<code>doLast</code>是<code>Task</code>的方法，查看<code>doFirst</code>的<a href="https://docs.gradle.org/current/dsl/org.gradle.api.Task.html#org.gradle.api.Task:doFirst(groovy.lang.Closure" target="_blank" rel="noopener">Reference文档</a>)，说是添加闭包到任务的action列表中，当任务执行的时候，会执行这个闭包。在配置阶段，并不会去执行任务，也就是说不会去执行<code>doFirst</code>和<code>doLast</code>闭包里的内容。<br>因此，在配置阶段，Gradle会依次执行三个任务方法里的闭包，而不会执行闭包里添加action的闭包即<code>doFirst</code>和<code>doLast</code>的闭包，因此会依次输出<br>‘build.gradle -&gt; task configured -&gt; …’ 和‘build.gradle -&gt; task testBoth -…’</p>
</li>
<li><p>执行阶段。<br>由于在命令行只构建testBoth任务，因此这个阶段只执行testBoth任务中的<code>Action</code>列表，依次执行<code>doFirst</code>和<code>doLast</code>的闭包。</p>
</li>
</ol>
<p><br></p>
<h1 id="示例-常见的多项目构建"><a href="#示例-常见的多项目构建" class="headerlink" title="示例-常见的多项目构建"></a>示例-常见的多项目构建</h1><p>参考官方手册<a href="https://docs.gradle.org/current/userguide/multi_project_builds.html#sec:project_jar_dependencies" target="_blank" rel="noopener">Authoring Multi-Project Builds</a><br>模拟一个常见的Java项目，目录结构如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">multi-project-build-lifecycle-demo/</span><br><span class="line">  settings.gradle</span><br><span class="line">  build.gradle</span><br><span class="line">  api/</span><br><span class="line">    src/main/java/</span><br><span class="line">      org/gradle/sample/</span><br><span class="line">        api/</span><br><span class="line">          Person.java</span><br><span class="line">        apiImpl/</span><br><span class="line">          PersonImpl.java</span><br><span class="line">  services/personService/</span><br><span class="line">    src/</span><br><span class="line">      main/java/</span><br><span class="line">        org/gradle/sample/services/</span><br><span class="line">          PersonService.java</span><br><span class="line">      test/java/</span><br><span class="line">        org/gradle/sample/services/</span><br><span class="line">          PersonServiceTest.java</span><br><span class="line">  shared/</span><br><span class="line">    src/main/java/</span><br><span class="line">      org/gradle/sample/shared/</span><br><span class="line">        Helper.java</span><br></pre></td></tr></table></figure>
<p>根目录<code>settings.gradle</code><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include <span class="string">'api'</span>, <span class="string">'shared'</span>, <span class="string">'services:personService'</span></span><br></pre></td></tr></table></figure></p>
<p>根目录<code>build.gradle</code><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">subprojects &#123;</span><br><span class="line">    apply <span class="string">plugin:</span> <span class="string">'java'</span></span><br><span class="line">    group = <span class="string">'org.gradle.sample'</span></span><br><span class="line">    version = <span class="string">'1.0'</span></span><br><span class="line">    repositories &#123;</span><br><span class="line">        mavenCentral()</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        testCompile <span class="string">"junit:junit:4.12"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">project(<span class="string">':shared'</span>) &#123;</span><br><span class="line">    task hello &#123;</span><br><span class="line">        doLast &#123;</span><br><span class="line">            println <span class="string">"shared task hello -&gt; doLast"</span></span><br><span class="line">        &#125;</span><br><span class="line">        println <span class="string">"shared task hello"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">project(<span class="string">':api'</span>) &#123;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        compile project(<span class="string">':shared'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    task hello &#123;</span><br><span class="line">        doLast &#123;</span><br><span class="line">            println <span class="string">"api task hello -&gt; doLast"</span></span><br><span class="line">        &#125;</span><br><span class="line">        println <span class="string">"api task hello"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">project(<span class="string">':services:personService'</span>) &#123;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        compile project(<span class="string">':shared'</span>), project(<span class="string">':api'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    task hello &#123;</span><br><span class="line">        doLast &#123;</span><br><span class="line">            println <span class="string">"personService task hello -&gt; doLast"</span></span><br><span class="line">        &#125;</span><br><span class="line">        println <span class="string">"personService task hello"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>执行命令<code>gradle -i :services:personService:hello</code>，输出如下</p>
<blockquote>
<p><code>-i</code> 是gradle的log等级的一种，输出较为详细的信息</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Initialized native services <span class="keyword">in</span>: /Users/zhangliang/.gradle/native</span><br><span class="line">The client will now receive all logging from the daemon (pid: 27188). The daemon <span class="built_in">log</span> file: /Users/zhangliang/.gradle/daemon/4.8.1/daemon-27188.out.log</span><br><span class="line">Starting 4th build <span class="keyword">in</span> daemon [uptime: 2 mins 55.761 secs, performance: 98%, no major garbage collections]</span><br><span class="line">Using 8 worker leases.</span><br><span class="line">Starting Build</span><br><span class="line">Settings evaluated using settings file <span class="string">'/Users/zhangliang/Projects/tools/learn-gradle/multi-project-build-lifecycle-demo/settings.gradle'</span>.</span><br><span class="line">Projects loaded. Root project using build file <span class="string">'/Users/zhangliang/Projects/tools/learn-gradle/multi-project-build-lifecycle-demo/build.gradle'</span>.</span><br><span class="line">Included projects: [root project <span class="string">'multi-project-build-lifecycle-demo'</span>, project <span class="string">':api'</span>, project <span class="string">':services'</span>, project <span class="string">':shared'</span>, project <span class="string">':services:personService'</span>]</span><br><span class="line"></span><br><span class="line">&gt; Configure project :</span><br><span class="line">Evaluating root project <span class="string">'multi-project-build-lifecycle-demo'</span> using build file <span class="string">'/Users/zhangliang/Projects/tools/learn-gradle/multi-project-build-lifecycle-demo/build.gradle'</span>.</span><br><span class="line">shared task hello</span><br><span class="line">api task hello</span><br><span class="line">personService task hello</span><br><span class="line"></span><br><span class="line">&gt; Configure project :api</span><br><span class="line">Evaluating project <span class="string">':api'</span> using build file <span class="string">'/Users/zhangliang/Projects/tools/learn-gradle/multi-project-build-lifecycle-demo/api/build.gradle'</span>.</span><br><span class="line"></span><br><span class="line">&gt; Configure project :services</span><br><span class="line">Evaluating project <span class="string">':services'</span> using build file <span class="string">'/Users/zhangliang/Projects/tools/learn-gradle/multi-project-build-lifecycle-demo/services/build.gradle'</span>.</span><br><span class="line"></span><br><span class="line">&gt; Configure project :shared</span><br><span class="line">Evaluating project <span class="string">':shared'</span> using build file <span class="string">'/Users/zhangliang/Projects/tools/learn-gradle/multi-project-build-lifecycle-demo/shared/build.gradle'</span>.</span><br><span class="line"></span><br><span class="line">&gt; Configure project :services:personService</span><br><span class="line">Evaluating project <span class="string">':services:personService'</span> using build file <span class="string">'/Users/zhangliang/Projects/tools/learn-gradle/multi-project-build-lifecycle-demo/services/personService/build.gradle'</span>.</span><br><span class="line">All projects evaluated.</span><br><span class="line">Selected primary task <span class="string">':services:personService:hello'</span> from project :services:personService</span><br><span class="line">Tasks to be executed: [task <span class="string">':services:personService:hello'</span>]</span><br><span class="line">:services:personService:hello (Thread[Task worker <span class="keyword">for</span> <span class="string">':'</span>,5,main]) started.</span><br><span class="line"></span><br><span class="line">&gt; Task :services:personService:hello</span><br><span class="line">Task <span class="string">':services:personService:hello'</span> is not up-to-date because:</span><br><span class="line">  Task has not declared any outputs despite executing actions.</span><br><span class="line">personService task hello -&gt; doLast</span><br><span class="line">:services:personService:hello (Thread[Task worker <span class="keyword">for</span> <span class="string">':'</span>,5,main]) completed. Took 0.001 secs.</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL <span class="keyword">in</span> 0s</span><br><span class="line">1 actionable task: 1 executed</span><br></pre></td></tr></table></figure>
<p>从输出可以看出：</p>
<ol>
<li>Gradle首先查找<code>settings.gradle</code>文件进行初始化，确定根项目目录并创建所有<code>include</code>的项目实例。其中包括<code>services</code>。</li>
<li>配置<code>settings.gradle</code>中<code>include</code>的所有的项目。项目配置的顺序，首先是根项目，其次是子项目，多个子项目看来也是按照字母顺序依次进行的。<blockquote>
<p>当前配置排序是<br>[root project ‘multi-project-build-lifecycle-demo’, project ‘:api’, project ‘:services’, project ‘:shared’, project ‘:services:personService’]<br>当我将‘shared’项目重命名为‘ashared’后，配置排序变为<br>[root project ‘multi-project-build-lifecycle-demo’, project ‘:api’, project ‘:ashared’, project ‘:services’, project ‘:services:personService’]</p>
</blockquote>
</li>
</ol>
<ol start="3">
<li>最后执行任务<code>:services:personService:hello</code>。</li>
</ol>
<p><br></p>
<h1 id="示例-按需配置的多项目构建"><a href="#示例-按需配置的多项目构建" class="headerlink" title="示例-按需配置的多项目构建"></a>示例-按需配置的多项目构建</h1><p>参考文档<a href="https://docs.gradle.org/current/userguide/multi_project_builds.html#example_build_script_of_water_parent_project" target="_blank" rel="noopener">Build script of water (parent) project</a></p>
<p>创建一个多项目工程，目录结构如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── bluewhale/</span><br><span class="line">├── build.gradle</span><br><span class="line">├── krill/</span><br><span class="line">└── settings.gradle</span><br></pre></td></tr></table></figure>
<p><code>settings.gradle</code>文件</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rootProject.name = <span class="string">'water'</span></span><br><span class="line">include <span class="string">'bluewhale'</span>, <span class="string">'krill'</span></span><br></pre></td></tr></table></figure>
<p><code>build.gradle</code>文件</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">    task hello &#123;</span><br><span class="line">        doLast &#123; task -&gt;</span><br><span class="line">            println <span class="string">"I'm $task.project.name"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>根目录下执行<code>gradle -i :bluewhale:hello</code>，输出如下（省略部分无关信息）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Initialized native services <span class="keyword">in</span>: /Users/zhangliang/.gradle/native</span><br><span class="line">Included projects: [root project <span class="string">'water'</span>, project <span class="string">':bluewhale'</span>, project <span class="string">':krill'</span>]</span><br><span class="line"></span><br><span class="line">&gt; Configure project :</span><br><span class="line">&gt; Configure project :bluewhale</span><br><span class="line">&gt; Configure project :krill</span><br><span class="line">All projects evaluated.</span><br><span class="line"></span><br><span class="line">&gt; Task :bluewhale:hello</span><br><span class="line">I<span class="string">'m bluewhale</span></span><br></pre></td></tr></table></figure>
<p>从输出可以看出，所有的项目都进行了配置。</p>
<p>根目录下执行<code>gradle -i :bluewhale:hello --configure-on-demand</code>，输出如下（省略部分无关信息）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Initialized native services <span class="keyword">in</span>: /Users/zhangliang/.gradle/native</span><br><span class="line">Included projects: [root project <span class="string">'water'</span>, project <span class="string">':bluewhale'</span>, project <span class="string">':krill'</span>]</span><br><span class="line">Configuration on demand is an incubating feature.</span><br><span class="line"></span><br><span class="line">&gt; Configure project :</span><br><span class="line">&gt; Configure project :bluewhale</span><br><span class="line">All projects evaluated.</span><br><span class="line"></span><br><span class="line">&gt; Task :bluewhale:hello</span><br><span class="line">I<span class="string">'m bluewhale</span></span><br></pre></td></tr></table></figure>
<p>上面的输出中出现了一句话”Configuration on demand is an incubating feature”，表示当前的“按需配置模式”还只是实验中的功能。从输出中可以看出，没有配置与任务无关的“krill”项目。</p>
<p><br></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a href="https://gradle.org/" target="_blank" rel="noopener">Gradle官网</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://www.xda-developers.com/files/2013/12/android-code.jpg"
               alt="Zhang Liang" />
          <p class="site-author-name" itemprop="name">Zhang Liang</p>
           
              <p class="site-description motion-element" itemprop="description">code android web</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhang Liang</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
